[tools]
rust = "latest"
"cargo:bacon" = "latest"
"cargo:cargo-audit" = "latest"
"cargo:cargo-outdated" = "latest"
"cargo:cargo-watch" = "latest"

[env]
APP_PROFILE = "debug"
RUST_BACKTRACE = "full"
RUST_LOG = "debug"

# ═══════════════════════════════════════════════════════════════
# File-Based Tasks
# ═══════════════════════════════════════════════════════════════
# Most tasks are defined as executable files in .mise/tasks/
# This provides better editor support, syntax highlighting, and standalone execution
#
# Available tasks:
#   setup        - First-time git hooks configuration
#   dev          - Start foreground dev mode (bacon)
#   dev-bg       - Start background dev mode (multiple watchers)
#   dev-stop     - Stop background dev mode
#   dev-status   - Check background dev mode status
#   verify       - Run all checks with auto-fix
#   verify-check - Run all checks without auto-fix (for CI)

# ═══════════════════════════════════════════════════════════════
# Simple Inline Tasks
# ═══════════════════════════════════════════════════════════════

[tasks.dev-logs]
description = "Show background development mode logs"
run = "tail -f .mise-dev.log"

[tasks.check]
description = "Quick check without codegen"
run = "cargo check --all-targets"

[tasks.test]
description = "Run all tests"
run = "cargo test"

[tasks.test-verbose]
description = "Run tests with output"
run = "cargo test -- --nocapture"

[tasks.lint]
description = "Run clippy and auto-fix warnings"
run = "cargo clippy --fix --allow-dirty --allow-staged --all-targets"

[tasks.lint-check]
description = "Run clippy without fixing (for CI)"
run = "cargo clippy --all-targets -- -D warnings"

[tasks.fmt]
description = "Format code"
run = "cargo fmt"

[tasks.fmt-check]
description = "Check formatting without modifying (for CI)"
run = "cargo fmt -- --check"

[tasks.ci]
description = "Run all CI checks locally"
depends = ["fmt-check", "lint-check", "test"]
run = "echo '✅ All CI checks passed!'"

# ═══════════════════════════════════════════════════════════════
# Build & Run Tasks
# ═══════════════════════════════════════════════════════════════

[tasks.build-debug]
description = "Build in debug mode"
run = "cargo build"

[tasks.run-debug]
description = "Build and run in debug mode"
run = "cargo build && ./target/debug/game"

[tasks.build-release]
description = "Build in release mode"
run = "cargo build --release"

[tasks.run-release]
description = "Build and run in release mode"
run = "cargo build --release && ./target/release/game"

[tasks.health-check]
description = "Run application health checks"
run = "cargo build --bin game && ./target/debug/game --health-check"

# ═══════════════════════════════════════════════════════════════
# Documentation Tasks
# ═══════════════════════════════════════════════════════════════

[tasks.doc]
description = "Build and open project documentation"
run = "cargo doc --no-deps --open"

[tasks.doc-watch]
description = "Rebuild documentation on changes (for dev-bg)"
run = "cargo doc --no-deps"

# ═══════════════════════════════════════════════════════════════
# Maintenance Tasks
# ═══════════════════════════════════════════════════════════════

[tasks.clean]
description = "Clean all build artifacts"
run = "cargo clean"

[tasks.update]
description = "Update dependencies"
run = "cargo update"

[tasks.outdated]
description = "Check for outdated dependencies"
run = "cargo outdated"

[tasks.audit]
description = "Run security audit"
run = "cargo audit"
